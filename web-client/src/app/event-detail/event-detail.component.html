<div class="event-detail-container">
  <!-- Header -->
  <div class="event-detail-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15,18 9,12 15,6"></polyline>
      </svg>
      Back to Past Events
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !eventDetail" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading event details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Error</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadEventDetail()">Retry</button>
  </div>

  <!-- Event Detail Content -->
  <div *ngIf="eventDetail && !loading" class="event-detail-content">
    <div class="main-content">
      <!-- Event Information -->
      <div class="event-info-card">
        <div class="event-header">
          <h1>{{ eventDetail.event.title }}</h1>
          <div class="event-status">
            <span class="status-badge completed">Completed</span>
          </div>
        </div>

        <div class="event-details-grid">
          <div class="detail-item">
            <div class="platform-logo-container" *ngIf="getPlatformLogo(eventDetail.platform)">
              <img [src]="getPlatformLogo(eventDetail.platform)"
                   [alt]="eventDetail.platform"
                   class="platform-logo">
            </div>
          </div>

          <div class="detail-item">
            <label>Start Time</label>
            <div class="start-time-display">
              <div class="time-text">{{ formatDateTime(eventDetail.startDateTime) }}</div>
            </div>
          </div>

          <div class="detail-item">
            <label>Attendees</label>
            <span>{{ eventDetail.attendees }}</span>
          </div>

          <div class="detail-item" *ngIf="eventDetail.event.description">
            <label>Description</label>
            <span>{{ eventDetail.event.description }}</span>
          </div>
        </div>
      </div>

      <!-- Generated Email -->
      <div class="generated-content-card">
        <h2>üìß Suggested Summary Email</h2>
        <div class="generated-text">
          {{ eventDetail.emailText }}
        </div>
        <button class="copy-btn" (click)="copyEmailText()" title="Copy email text">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          Copy
        </button>
      </div>

      <!-- Generated Social Media Post -->
      <div class="generated-content-card">
        <h2>üì± Suggested Social Media Post</h2>
        <div class="generated-text">
          {{ eventDetail.postText }}
        </div>
        <div class="post-actions">
          <button class="copy-btn" (click)="copyPostText()" title="Copy post text">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Copy
          </button>
          <button
            class="linkedin-btn"
            (click)="postToLinkedIn()"
            [disabled]="!localStorage.getItem('linkedinUsername')"
            [class.disabled]="!localStorage.getItem('linkedinUsername')"
            title="Post to LinkedIn"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Post on LinkedIn
          </button>
        </div>
      </div>

      <!-- Meeting Content -->
      <div class="meeting-content-card" *ngIf="eventDetail.transcript">
        <h2>Meeting Transcript</h2>
        <div class="transcript-content">
          <pre>{{ formatTranscriptAsJson(eventDetail.transcript) }}</pre>
        </div>
      </div>

    </div>

    <!-- Automations Sidebar -->
    <div class="automations-sidebar">
      <div class="sidebar-header">
        <h3>Automations</h3>
        <p>Click on an automation to view generated content</p>
      </div>

      <div class="automations-list" *ngIf="automations.length > 0; else noAutomations">
        <div
          *ngFor="let automation of automations"
          class="automation-item"
          (click)="onAutomationClick(automation)"
        >
          <div class="automation-header">
            <h4>{{ getAutomationTypeDisplay(automation.title) }}</h4>
            <span class="platform-badge">{{ getPlatformDisplay(automation.mediaPlatform) }}</span>
          </div>
          <p class="automation-description">{{ automation.description }}</p>
        </div>
      </div>

      <ng-template #noAutomations>
        <div class="no-automations">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
          <p>No automations available</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Automation Popup Modal -->
  <div *ngIf="showAutomationPopup" class="modal-overlay" (click)="closeAutomationPopup()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedAutomation?.automation?.title || 'Automation Content' }}</h2>
        <button class="close-btn" (click)="closeAutomationPopup()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <!-- Success Message -->
        <div *ngIf="successMessage" class="success-message">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22,4 12,14.01 9,11.01"></polyline>
          </svg>
          {{ successMessage }}
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="error-message">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          {{ error }}
        </div>

        <div class="automation-info">
          <div class="automation-meta">
            <span class="automation-type">{{ getAutomationTypeDisplay(getSelectedAutomationType()) }}</span>
            <span class="automation-platform">{{ getPlatformDisplay(getSelectedAutomationPlatform()) }}</span>
          </div>
        </div>

        <div class="automation-content">
          <!-- Automation Description and Example -->
          <div class="automation-details" *ngIf="selectedAutomation?.automation">
            <div class="automation-description" *ngIf="selectedAutomation?.automation?.description">
              <h4>Description</h4>
              <p>{{ selectedAutomation?.automation?.description }}</p>
            </div>
            <div class="automation-example" *ngIf="selectedAutomation?.automation?.example">
              <h4>Example</h4>
              <p>{{ selectedAutomation?.automation?.example }}</p>
            </div>
          </div>

          <!-- Generated Content Title -->
          <h3 *ngIf="selectedAutomation?.title">{{ selectedAutomation?.title }}</h3>
          <div class="content-text">
            {{ selectedAutomation?.text }}
          </div>
        </div>

        <div class="modal-actions">
          <button class="action-btn copy-btn" (click)="copyText()" [disabled]="loading">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Copy Text
          </button>

          <button class="action-btn regenerate-btn" (click)="regenerateAutomation()" [disabled]="loading">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"></polyline>
              <polyline points="1 20 1 14 7 14"></polyline>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
            </svg>
            <span *ngIf="loading">Regenerating...</span>
            <span *ngIf="!loading">Regenerate</span>
          </button>

          <button
            class="action-btn post-btn"
            (click)="postToLinkedIn()"
            [disabled]="loading || !isLinkedInAutomation()"
            [class.disabled]="!isLinkedInAutomation()"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
            <span *ngIf="loading">Posting...</span>
            <span *ngIf="!loading">Post to LinkedIn</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
